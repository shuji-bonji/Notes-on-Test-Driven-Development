# ãƒ¢ãƒƒã‚¯ã¨ã‚¹ã‚¿ãƒ–ã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆ
å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã§ã¯ã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚³ãƒ¼ãƒ‰ãŒå¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã‚„ã‚µãƒ¼ãƒ“ã‚¹ã«ä¾å­˜ã—ã¦ã„ã‚‹ã“ã¨ãŒå¤šãã‚ã‚Šã¾ã™ã€‚  
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã€APIã‚³ãƒ¼ãƒ«ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®æ“ä½œãªã©ã€ã“ã‚Œã‚‰ã®å¤–éƒ¨ä¾å­˜ã¯ãƒ†ã‚¹ãƒˆã‚’è¤‡é›‘ã«ã—ã€å®Ÿè¡Œé€Ÿåº¦ã‚’ä½ä¸‹ã•ã›ã‚‹åŸå› ã¨ãªã‚Šã¾ã™ã€‚

ã“ã“ã§ã¯ã€ãƒ¢ãƒƒã‚¯ã¨ã‚¹ã‚¿ãƒ–ã‚’ä½¿ç”¨ã—ã¦å¤–éƒ¨ä¾å­˜ã‚’åˆ†é›¢ã—ã€åŠ¹ç‡çš„ã‹ã¤ä¿¡é ¼æ€§ã®é«˜ã„ãƒ†ã‚¹ãƒˆã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è¨˜ã—ã¾ã™ã€‚

## ç›®æ¬¡

1. [ãƒ¢ãƒƒã‚¯ã¨ã‚¹ã‚¿ãƒ–ã®æ¦‚å¿µ](#ãƒ¢ãƒƒã‚¯ã¨ã‚¹ã‚¿ãƒ–ã®æ¦‚å¿µ)
2. [Vitestã§ã®ãƒ¢ãƒƒã‚¯ä½œæˆ](#vitestã§ã®ãƒ¢ãƒƒã‚¯ä½œæˆ)
3. [å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ¢ãƒƒã‚¯åŒ–](#å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ¢ãƒƒã‚¯åŒ–)
4. [ä¾å­˜æ€§æ³¨å…¥ã‚’æ´»ç”¨ã—ãŸãƒ†ã‚¹ãƒˆ](#ä¾å­˜æ€§æ³¨å…¥ã‚’æ´»ç”¨ã—ãŸãƒ†ã‚¹ãƒˆ)
5. [ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ¢ãƒƒã‚¯åŒ–](#ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ¢ãƒƒã‚¯åŒ–)
6. [è‡ªä½œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ¢ãƒƒã‚¯åŒ–](#è‡ªä½œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ¢ãƒƒã‚¯åŒ–)
6. [é«˜åº¦ãªãƒ¢ãƒƒã‚¯ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯](#é«˜åº¦ãªãƒ¢ãƒƒã‚¯ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯)
7. [å®Ÿè·µçš„ãªãƒ’ãƒ³ãƒˆ](#å®Ÿè·µçš„ãªãƒ’ãƒ³ãƒˆ)

## ãƒ¢ãƒƒã‚¯ã¨ã‚¹ã‚¿ãƒ–ã®æ¦‚å¿µ
ãƒ†ã‚¹ãƒˆãƒ€ãƒ–ãƒ«ï¼ˆTest Doubleï¼‰ã¨ã¯ãƒ†ã‚¹ãƒˆä¸­ã«æœ¬ç‰©ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä»£ã‚ã‚Šã«ä½¿ç”¨ã™ã‚‹ä»£æ›¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç·ç§°ã§ã™ã€‚  
ãã®ä¸­ã§ã‚‚ç‰¹ã«ã‚ˆãä½¿ã‚ã‚Œã‚‹ã®ãŒã€Œãƒ¢ãƒƒã‚¯ã€ã¨ã€Œã‚¹ã‚¿ãƒ–ã€ã§ã™ã€‚

|ãƒ†ã‚¹ãƒˆãƒ€ãƒ–ãƒ«|èª¬æ˜|
|---|---|
|ã‚¹ã‚¿ãƒ–ï¼ˆStubï¼‰|å›ºå®šã®å€¤ã‚’è¿”ã™ã€ã‚·ãƒ³ãƒ—ãƒ«ãªä»£æ›¿é–¢æ•°ã€‚æŒ¯ã‚‹èˆã„ã®åˆ‡ã‚Šæ›¿ãˆã«ä¾¿åˆ©|
|ãƒ¢ãƒƒã‚¯ï¼ˆMockï¼‰|å‘¼ã³å‡ºã—å±¥æ­´ã‚’æ¤œè¨¼å¯èƒ½ãªãƒ†ã‚¹ãƒˆç”¨ãƒ€ãƒŸãƒ¼ã€‚å‰¯ä½œç”¨ãªã—ã§æŒ¯ã‚‹èˆã„ã‚’å†ç¾|

### ã‚¹ã‚¿ãƒ– (Stub)
ã‚¹ã‚¿ãƒ–ã¯ã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ã‚³ãƒ¼ãƒ‰ãŒä¾å­˜ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç°¡æ˜“çš„ãªä»£æ›¿ã§ã™ã€‚  
å®šç¾©ã•ã‚ŒãŸå…¥åŠ›ã«å¯¾ã—ã¦æ±ºã¾ã£ãŸå‡ºåŠ›ã‚’è¿”ã™ã ã‘ã®å˜ç´”ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã€ã€ŒçŠ¶æ…‹æ¤œè¨¼ã€ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

#### ç‰¹å¾´:
- æ±ºã¾ã£ãŸå¿œç­”ã‚’è¿”ã™
- å‘¼ã³å‡ºã•ã‚ŒãŸã“ã¨ã®æ¤œè¨¼æ©Ÿèƒ½ã‚’æŒãŸãªã„
- å˜ç´”ãªã‚·ãƒŠãƒªã‚ªã®ãƒ†ã‚¹ãƒˆã«é©ã—ã¦ã„ã‚‹

### ãƒ¢ãƒƒã‚¯ (Mock)

ãƒ¢ãƒƒã‚¯ã¯ã‚¹ã‚¿ãƒ–ã‚ˆã‚Šé«˜åº¦ã§ã€å‘¼ã³å‡ºã•ã‚ŒãŸå›æ•°ã‚„æ¸¡ã•ã‚ŒãŸå¼•æ•°ãªã©ã®æ¤œè¨¼æ©Ÿèƒ½ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚  
ã€ŒæŒ¯ã‚‹èˆã„æ¤œè¨¼ã€ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚

#### ç‰¹å¾´:
- æ±ºã¾ã£ãŸå¿œç­”ã‚’è¿”ã™
- å‘¼ã³å‡ºã•ã‚ŒãŸå›æ•°ã‚„å¼•æ•°ãªã©ã‚’è¨˜éŒ²ã—æ¤œè¨¼ã§ãã‚‹
- è¤‡é›‘ãªç›¸äº’ä½œç”¨ã®ãƒ†ã‚¹ãƒˆã«é©ã—ã¦ã„ã‚‹

### ãã®ä»–ã®ãƒ†ã‚¹ãƒˆãƒ€ãƒ–ãƒ«
|ãƒ†ã‚¹ãƒˆãƒ€ãƒ–ãƒ«|èª¬æ˜|
|---|---|
|ã‚¹ãƒ‘ã‚¤ (Spy)|å®Ÿéš›ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ©ãƒƒãƒ—ã—ã€ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã‚’è¨˜éŒ²ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ|
|ãƒ•ã‚§ã‚¤ã‚¯ (Fake)|å®Ÿéš›ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚ˆã‚Šç°¡ç•¥åŒ–ã•ã‚ŒãŸå®Ÿè£…ã‚’æŒã¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ|
|ãƒ€ãƒŸãƒ¼ (Dummy)|å€¤ã‚’è¿”ã•ãªã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ|

> [!NOTE]
> ãƒ†ã‚¹ãƒˆãƒ€ãƒ–ãƒ« ã¨ã¯:  
> ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãƒ†ã‚¹ãƒˆã«ãŠã„ã¦ã€ãƒ†ã‚¹ãƒˆå¯¾è±¡ãŒä¾å­˜ã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç½®ãæ›ãˆã‚‹ä»£ç”¨å“ã®ã“ã¨ã€‚  
> ãƒ€ãƒ–ãƒ«ã¯ä»£å½¹ã€å½±æ­¦è€…ã‚’æ„å‘³ã™ã‚‹ã€‚
> ```
> ãƒ†ã‚¹ãƒˆãƒ€ãƒ–ãƒ«
> â”œâ”€ ã‚¹ã‚¿ãƒ–ï¼šå›ºå®šå¿œç­”ã®ã¿
> â”œâ”€ ãƒ¢ãƒƒã‚¯ï¼šå±¥æ­´æ¤œè¨¼ï¼‹å›ºå®šå¿œç­”
> â”œâ”€ ã‚¹ãƒ‘ã‚¤ï¼šå®Ÿä½“ã‚’ãƒ©ãƒƒãƒ—ã—ã¦æ¤œè¨¼
> â”œâ”€ ãƒ•ã‚§ã‚¤ã‚¯ï¼šç°¡æ˜“ãªå®Ÿè£…
> â””â”€ ãƒ€ãƒŸãƒ¼ï¼šä½¿ã‚ã‚Œãªã„å¼•æ•°ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€
> ```

## ãªãœãƒ¢ãƒƒã‚¯ã‚’ä½¿ã†ã®ã‹
å®Ÿéš›ã®ä¾å­˜é–¢ä¿‚ï¼ˆAPIãƒ»DBãªã©ï¼‰ã‚’ãã®ã¾ã¾ä½¿ã†ã¨ã€ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œé€Ÿåº¦ãŒä½ä¸‹ã—ã€ä¸å®‰å®šã«ãªã‚Šã¾ã™ã€‚  
ãƒ¢ãƒƒã‚¯ã¨ã‚¹ã‚¿ãƒ–ã‚’ä½¿ã†ã“ã¨ã§ã€ã“ã†ã—ãŸä¾å­˜ã‚’åˆ¶å¾¡ã—ã€å†ç¾æ€§ãƒ»é«˜é€Ÿæ€§ãƒ»å±€æ‰€æ€§ã®é«˜ã„ãƒ†ã‚¹ãƒˆã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã€ãƒ­ã‚°è¨˜éŒ²ã€å¤–éƒ¨APIå‘¼ã³å‡ºã—ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³æ“ä½œãªã©ã¯ã™ã¹ã¦å‰¯ä½œç”¨ã‚’ä¼´ã†ãŸã‚ã€ãƒ¢ãƒƒã‚¯ã®é©ç”¨å¯¾è±¡ã«ãªã‚Šã¾ã™ã€‚
 
## Vitestã§ã®ãƒ¢ãƒƒã‚¯ä½œæˆ
Vitestã§ã¯ã€`vi.fn()`ã€`vi.mock()`ãªã©ã®é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦ãƒ¢ãƒƒã‚¯ã‚’ä½œæˆã§ãã¾ã™ã€‚

### åŸºæœ¬çš„ãªãƒ¢ãƒƒã‚¯é–¢æ•°
```ts
// åŸºæœ¬çš„ãªãƒ¢ãƒƒã‚¯é–¢æ•°ã®ä½œæˆ
const mockFunction = vi.fn();

// æˆ»ã‚Šå€¤ã®è¨­å®š
mockFunction.mockReturnValue('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤');

// ç‰¹å®šã®å‘¼ã³å‡ºã—ã«å¯¾ã™ã‚‹æˆ»ã‚Šå€¤ã®è¨­å®š
mockFunction.mockReturnValueOnce('1å›ç›®ã®å‘¼ã³å‡ºã—')
            .mockReturnValueOnce('2å›ç›®ã®å‘¼ã³å‡ºã—');

// ãƒ¢ãƒƒã‚¯é–¢æ•°ã®å‘¼ã³å‡ºã—
const result1 = mockFunction(); // '1å›ç›®ã®å‘¼ã³å‡ºã—'
const result2 = mockFunction(); // '2å›ç›®ã®å‘¼ã³å‡ºã—'
const result3 = mockFunction(); // 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤'

// æ¤œè¨¼
expect(mockFunction).toHaveBeenCalledTimes(3);
expect(mockFunction.mock.calls.length).toBe(3);
```

### éåŒæœŸãƒ¢ãƒƒã‚¯é–¢æ•°
```ts
// éåŒæœŸãƒ¢ãƒƒã‚¯é–¢æ•°ã®ä½œæˆ
const asyncMock = vi.fn().mockResolvedValue('æˆåŠŸ');

// ç‰¹å®šã®å‘¼ã³å‡ºã—ã«å¯¾ã™ã‚‹æˆ»ã‚Šå€¤ã®è¨­å®š
asyncMock.mockResolvedValueOnce('1å›ç›®ã®æˆåŠŸ')
         .mockRejectedValueOnce(new Error('ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ'));

// éåŒæœŸãƒ¢ãƒƒã‚¯é–¢æ•°ã®å‘¼ã³å‡ºã—
const result1 = await asyncMock(); // '1å›ç›®ã®æˆåŠŸ'
await expect(asyncMock()).rejects.toThrow('ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ');
const result3 = await asyncMock(); // 'æˆåŠŸ'
```


## å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ¢ãƒƒã‚¯åŒ–
å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆAPIã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã©ï¼‰ã¸ã®ä¾å­˜ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã™ã‚‹ã“ã¨ã§ã€ãƒ†ã‚¹ãƒˆã‚’é«˜é€Ÿã‹ã¤ä¿¡é ¼æ€§ã®é«˜ã„ã‚‚ã®ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### RedğŸ”´: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
#### `apiService.test.ts`

```ts
import { UserService } from '../src/userService';
import { HttpClient } from '../src/httpClient';

describe('UserService', () => {
  it('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã§ãã‚‹', async () => {
    // HttpClientã®ãƒ¢ãƒƒã‚¯
    const mockHttpClient: HttpClient = {
      get: vi.fn().mockResolvedValue({
        id: 1,
        name: 'John Doe',
        email: 'john@example.com'
      })
    };

    // ãƒ¢ãƒƒã‚¯ã‚’æ³¨å…¥ã—ã¦UserServiceã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
    const userService = new UserService(mockHttpClient);

    // ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œ
    const user = await userService.getUser(1);

    // çµæœã‚’æ¤œè¨¼
    expect(user).toEqual({
      id: 1,
      name: 'John Doe',
      email: 'john@example.com'
    });

    // HttpClientã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£ã—ãå‘¼ã°ã‚ŒãŸã‹æ¤œè¨¼
    expect(mockHttpClient.get).toHaveBeenCalledWith('/users/1');
    expect(mockHttpClient.get).toHaveBeenCalledTimes(1);
  });

  it('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™', async () => {
    // ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹ãƒ¢ãƒƒã‚¯
    const mockHttpClient: HttpClient = {
      get: vi.fn().mockRejectedValue(new Error('User not found'))
    };

    const userService = new UserService(mockHttpClient);

    // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª
    await expect(userService.getUser(999)).rejects.toThrow('User not found');
  });
});
```

### GreenğŸŸ¢: ãƒ†ã‚¹ãƒˆã‚’é€šã™ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
#### `userService.ts`
```ts
import { HttpClient } from './httpClient';

type User = {
  id: string;
  name: string;
  email: string;
};

export class UserService {
  constructor(private httpClient: HttpClient) {}
  async getUser(userId: string): Promise<User> {
    return this.httpClient.get(`/users/${userId}`);
  }
}
```
#### `httpClient.ts`
```ts
export interface HttpClient {
  get(url: string): Promise<any>;
  post?(url: string, data: any): Promise<any>;
  put?(url: string, data: any): Promise<any>;
  delete?(url: string): Promise<any>;
}
```


### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã®ãƒ¢ãƒƒã‚¯ä¾‹

### RedğŸ”´: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
#### `userRepository.test.ts`

```ts
import { UserRepository } from '../src/userRepository';
import { DatabaseConnection } from '../src/database';

describe('UserRepository', () => {
  it('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—ã§ãã‚‹', async () => {
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®ãƒ¢ãƒƒã‚¯
    const mockDbConnection: DatabaseConnection = {
      query: vi.fn().mockResolvedValue([
        {
          id: '1',
          name: 'Jane Doe',
          email: 'jane@example.com',
          createdAt: new Date('2025-04-01T00:00:00Z'),
        },
      ]),
    };

    // ãƒ¢ãƒƒã‚¯ã‚’æ³¨å…¥ã—ã¦UserRepositoryã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
    const userRepo = new UserRepository(mockDbConnection);

    // ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œ
    const user = await userRepo.findById('1');

    // çµæœã‚’æ¤œè¨¼
    expect(user).toEqual({
      id: '1',
      name: 'Jane Doe',
      email: 'jane@example.com',
      createdAt: new Date('2025-04-01T00:00:00Z'),
    });

    // ã‚¯ã‚¨ãƒªãŒæ­£ã—ãå‘¼ã°ã‚ŒãŸã‹æ¤œè¨¼
    expect(mockDbConnection.query).toHaveBeenCalledWith(
      'SELECT * FROM users WHERE id = ?',
      ['1']
    );
  });

  it('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ãªã„å ´åˆã€nullã‚’è¿”ã™', async () => {
    // ç©ºã®çµæœã‚’è¿”ã™ãƒ¢ãƒƒã‚¯
    const mockDbConnection: DatabaseConnection = {
      query: vi.fn().mockResolvedValue([]),
    };

    const userRepo = new UserRepository(mockDbConnection);
    const user = await userRepo.findById('999');

    expect(user).toBeNull();
  });
});
```

### GreenğŸŸ¢: ãƒ†ã‚¹ãƒˆã‚’é€šã™ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
#### `database.ts`

```ts
import { DatabaseConnection } from './database';

export type UserDate = {
  id: string;
  name: string;
  email: string;
  createdAt: Date;
};

export class UserRepository {
  constructor(private dbConnection: DatabaseConnection) {}
  async findById(userId: string): Promise<UserDate | null> {
    const result = await this.dbConnection.query(
      'SELECT * FROM users WHERE id = ?',
      [userId]
    );
    if (result.length === 0) return null;
    return result[0];
  }
}
```
#### `database.ts`
```ts
import { UserDate } from './userRepository';

export interface DatabaseConnection {
  query(sql: string, param?: any[]): Promise<Array<any>>;
}
```

## ä¾å­˜æ€§æ³¨å…¥ã‚’æ´»ç”¨ã—ãŸãƒ†ã‚¹ãƒˆ
ä¾å­˜æ€§æ³¨å…¥ï¼ˆDependency Injectionï¼‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ¢ãƒƒã‚¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚¯ãƒ©ã‚¹ã«ç°¡å˜ã«æ³¨å…¥ã§ãã¾ã™ã€‚  
ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆã®æŸ”è»Ÿæ€§ã¨ä¿å®ˆæ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚

### é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ã®ä¾‹

### RedğŸ”´: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
#### `notificationService.test.ts`

```ts
import { NotificationService } from '../src/notificationService';
import { EmailSender, SmsSender, User } from '../src/interfaces';

describe('NotificationService', () => {
  // ãƒ¢ãƒƒã‚¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
  const mockEmailSender: EmailSender = {
    sendEmail: vi.fn().mockResolvedValue(true),
  };

  const mockSmsSender: SmsSender = {
    sendSms: vi.fn().mockResolvedValue(true),
  };

  // ãƒ†ã‚¹ãƒˆç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿
  const testUser: User = {
    id: '1',
    name: 'Test User',
    email: 'test@example.com',
    phone: '+1234567890',
  };

  let notificationService: NotificationService;

  beforeEach(() => {
    // å„ãƒ†ã‚¹ãƒˆå‰ã«ãƒ¢ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆ
    vi.clearAllMocks();

    // ä¾å­˜æ€§ã‚’æ³¨å…¥ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆ
    notificationService = new NotificationService(
      mockEmailSender,
      mockSmsSender
    );
  });

  it('ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã‚’é€ä¿¡ã§ãã‚‹', async () => {
    const result = await notificationService.notifyByEmail(
      testUser,
      'ãƒ†ã‚¹ãƒˆé€šçŸ¥',
      'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆé€šçŸ¥ã§ã™ã€‚'
    );

    expect(result).toBe(true);
    expect(mockEmailSender.sendEmail).toHaveBeenCalledWith(
      testUser.email,
      'ãƒ†ã‚¹ãƒˆé€šçŸ¥',
      'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆé€šçŸ¥ã§ã™ã€‚'
    );
  });

  it('SMSé€šçŸ¥ã‚’é€ä¿¡ã§ãã‚‹', async () => {
    const result = await notificationService.notifyBySms(
      testUser,
      'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆSMSã§ã™ã€‚'
    );

    expect(result).toBe(true);
    expect(mockSmsSender.sendSms).toHaveBeenCalledWith(
      testUser.phone,
      'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆSMSã§ã™ã€‚'
    );
  });

  it('å…¨ãƒãƒ£ãƒãƒ«ã§é€šçŸ¥ã‚’é€ä¿¡ã§ãã‚‹', async () => {
    const result = await notificationService.notifyAll(
      testUser,
      'ãƒãƒ«ãƒãƒãƒ£ãƒãƒ«é€šçŸ¥',
      'ã“ã‚Œã¯å…¨ãƒãƒ£ãƒãƒ«ã¸ã®é€šçŸ¥ã§ã™ã€‚'
    );

    expect(result).toBe(true);
    expect(mockEmailSender.sendEmail).toHaveBeenCalled();
    expect(mockSmsSender.sendSms).toHaveBeenCalled();
  });

  it('ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãŒå¤±æ•—ã—ã¦ã‚‚å‡¦ç†ã‚’ç¶™ç¶šã™ã‚‹', async () => {
    // ä¸€æ™‚çš„ã«ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹ã‚ˆã†ã«ãƒ¢ãƒƒã‚¯ã‚’è¨­å®š
    mockEmailSender.sendEmail.mockRejectedValueOnce(new Error('é€ä¿¡å¤±æ•—'));

    const result = await notificationService.notifyAll(
      testUser,
      'ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ',
      'ã“ã‚Œã¯ã‚¨ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆã§ã™ã€‚'
    );

    // SMSã¯æˆåŠŸã™ã‚‹ã®ã§trueã‚’è¿”ã™
    expect(result).toBe(true);
    expect(mockEmailSender.sendEmail).toHaveBeenCalled();
    expect(mockSmsSender.sendSms).toHaveBeenCalled();
  });
});

```

### GreenğŸŸ¢: ãƒ†ã‚¹ãƒˆã‚’é€šã™ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
#### `interfaces.ts`
```ts
export interface User {
  id: string;
  name: string;
  email: string;
  phone: string;
}

export interface EmailSender {
  sendEmail(email: string, subject: string, body: string): Promise<boolean>;
}
export interface SmsSender {
  sendSms(phone: string, message: string): Promise<boolean>;
}
```

#### `notificationService.ts`
```ts
import { EmailSender, SmsSender, User } from './interfaces';

export class NotificationService {
  constructor(private emailSender: EmailSender, private smsSender: SmsSender) {}
  async notifyByEmail(
    user: User,
    title: string,
    body: string
  ): Promise<boolean> {
    return this.emailSender.sendEmail(user.email, title, body);
  }
  async notifyBySms(user: User, message: string): Promise<boolean> {
    return this.smsSender.sendSms(user.phone, message);
  }
  async notifyAll(user: User, title: string, body: string): Promise<boolean> {
    try {
      this.emailSender.sendEmail(user.email, title, body);
    } catch (error) {
      console.error('ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
    }
    this.smsSender.sendSms(user.phone, body);
    return true;
  }
}
```


## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ¢ãƒƒã‚¯åŒ–
æ™‚ã«ã¯ã€ç‰¹å®šã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å…¨ä½“ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã—ãŸã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚  
Vitestã®`vi.mock()`ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã™ã¹ã¦ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’ãƒ¢ãƒƒã‚¯åŒ–ã§ãã¾ã™ã€‚


### RedğŸ”´: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
#### `userImporter.test.ts`

```ts
import { importUsersFromApi } from '../src/userImporter';

// axios ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å…¨ä½“ã‚’ãƒ¢ãƒƒã‚¯åŒ–
vi.mock('axios', () => ({
  default: {
    get: vi.fn(),
  },
}));

// ãƒ¢ãƒƒã‚¯åŒ–ã—ãŸaxiosã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import axios from 'axios';

describe('importUsersFromApi', () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });

  it('APIã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹', async () => {
    // ãƒ¢ãƒƒã‚¯ã®å®Ÿè£…ã‚’è¨­å®š
    (axios.get as any).mockResolvedValue({
      data: [
        {
          id: '1',
          first_name: 'John',
          last_name: 'Doe',
          email: 'john@example.com',
        },
        {
          id: '2',
          first_name: 'Jane',
          last_name: 'Smith',
          email: 'jane@example.com',
        },
      ],
    });

    const users = await importUsersFromApi();

    expect(users).toEqual([
      { id: '1', name: 'John Doe', email: 'john@example.com' },
      { id: '2', name: 'Jane Smith', email: 'jane@example.com' },
    ]);

    expect(axios.get).toHaveBeenCalledWith('https://api.example.com/users');
  });

  it('ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã¯ç©ºé…åˆ—ã‚’è¿”ã™', async () => {
    // ã‚¨ãƒ©ãƒ¼ã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹ãƒ¢ãƒƒã‚¯
    (axios.get as any).mockRejectedValue(new Error('Network Error'));

    const users = await importUsersFromApi();

    expect(users).toEqual([]);
    expect(axios.get).toHaveBeenCalled();
  });
});
```

### GreenğŸŸ¢: ãƒ†ã‚¹ãƒˆã‚’é€šã™ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
#### `userImporter.ts`

```ts
import axios from 'axios';

type ApiUser = {
  id: string;
  first_name: string;
  last_name: string;
  email: string;
};

type User = {
  id: string;
  name: string;
  email: string;
};

export const importUsersFromApi = async () => {
  try {
    const response = await axios.get('https://api.example.com/users');
    const apiUsers: ApiUser[] = response.data;
    return apiUsers.map((apiUser) => ({
      id: apiUser.id,
      name: `${apiUser.first_name} ${apiUser.last_name}`,
      email: apiUser.email,
    }));
  } catch (error) {
    console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
    return [];
  }
};
```


## è‡ªä½œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ¢ãƒƒã‚¯åŒ–

### RedğŸ”´: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
#### `userController.test.ts`

```ts
import { vi, describe, it, expect, beforeEach } from 'vitest';
import { UserController } from './userController';

// userServiceãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ¢ãƒƒã‚¯åŒ–
vi.mock('./userService', () => ({
  UserService: vi.fn(() => ({
    getUser: vi.fn(),
    createUser: vi.fn(),
    updateUser: vi.fn(),
    deleteUser: vi.fn()
  }))
}));

// ãƒ¢ãƒƒã‚¯ã•ã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import { UserService } from './userService';

describe('UserController', () => {
  let userController: UserController;
  let mockUserService: any;

  beforeEach(() => {
    vi.clearAllMocks();
    // ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—
    mockUserService = new UserService();
    userController = new UserController(mockUserService);
  });

  it('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å–å¾—ã‚’ã‚µãƒ¼ãƒ“ã‚¹ã«å§”è­²ã™ã‚‹', async () => {
    // ãƒ¢ãƒƒã‚¯ã®æŒ¯ã‚‹èˆã„ã‚’è¨­å®š
    mockUserService.getUser.mockResolvedValue({
      id: 1,
      name: 'Test User',
      email: 'test@example.com'
    });

    const req = { params: { id: '1' } };
    const res = {
      status: vi.fn().mockReturnThis(),
      json: vi.fn()
    };

    await userController.getUser(req as any, res as any);

    expect(mockUserService.getUser).toHaveBeenCalledWith(1);
    expect(res.status).toHaveBeenCalledWith(200);
    expect(res.json).toHaveBeenCalledWith({
      id: 1,
      name: 'Test User',
      email: 'test@example.com'
    });
  });

  it('ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆã‚’ã‚µãƒ¼ãƒ“ã‚¹ã«å§”è­²ã™ã‚‹', async () => {
    mockUserService.createUser.mockResolvedValue({
      id: 1,
      name: 'New User',
      email: 'new@example.com'
    });

    const req = {
      body: {
        name: 'New User',
        email: 'new@example.com'
      }
    };
    const res = {
      status: vi.fn().mockReturnThis(),
      json: vi.fn()
    };

    await userController.createUser(req as any, res as any);

    expect(mockUserService.createUser).toHaveBeenCalledWith({
      name: 'New User',
      email: 'new@example.com'
    });
    expect(res.status).toHaveBeenCalledWith(201);
    expect(res.json).toHaveBeenCalled();
  });

  it('ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã¯500ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™', async () => {
    mockUserService.getUser.mockRejectedValue(new Error('ã‚µãƒ¼ãƒ“ã‚¹ã‚¨ãƒ©ãƒ¼'));

    const req = { params: { id: '1' } };
    const res = {
      status: vi.fn().mockReturnThis(),
      json: vi.fn()
    };

    await userController.getUser(req as any, res as any);

    expect(res.status).toHaveBeenCalledWith(500);
    expect(res.json).toHaveBeenCalledWith({
      error: 'ã‚µãƒ¼ãƒ“ã‚¹ã‚¨ãƒ©ãƒ¼'
    });
  });
});
```

### GreenğŸŸ¢: ãƒ†ã‚¹ãƒˆã‚’é€šã™ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
#### `userController.ts`

```ts
import { Request, Response } from 'express';
import { UserService } from './userService';

export class UserController {
  constructor(private userService: UserService) {}

  async getUser(req: Request, res: Response): Promise<void> {
    try {
      const userId = parseInt(req.params.id, 10);
      const user = await this.userService.getUser(userId);
      res.status(200).json(user);
    } catch (error) {
      res.status(500).json({
        error: error instanceof Error ? error.message : 'Unknown error'
      });
    }
  }

  async createUser(req: Request, res: Response): Promise<void> {
    try {
      const userData = req.body;
      const newUser = await this.userService.createUser(userData);
      res.status(201).json(newUser);
    } catch (error) {
      res.status(500).json({
        error: error instanceof Error ? error.message : 'Unknown error'
      });
    }
  }

  async updateUser(req: Request, res: Response): Promise<void> {
    try {
      const userId = parseInt(req.params.id, 10);
      const userData = req.body;
      const updatedUser = await this.userService.updateUser(userId, userData);
      res.status(200).json(updatedUser);
    } catch (error) {
      res.status(500).json({
        error: error instanceof Error ? error.message : 'Unknown error'
      });
    }
  }

  async deleteUser(req: Request, res: Response): Promise<void> {
    try {
      const userId = parseInt(req.params.id, 10);
      await this.userService.deleteUser(userId);
      res.status(204).send();
    } catch (error) {
      res.status(500).json({
        error: error instanceof Error ? error.message : 'Unknown error'
      });
    }
  }
}
```


## é«˜åº¦ãªãƒ¢ãƒƒã‚¯ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯

### ã‚¹ãƒ‘ã‚¤ã®ä½¿ç”¨
å®Ÿéš›ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ©ãƒƒãƒ—ã—ã€ãã®å‘¼ã³å‡ºã—ã‚’è¨˜éŒ²ã™ã‚‹ã‚¹ãƒ‘ã‚¤ã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚

```ts
// å®Ÿéš›ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
const calculator = {
  add(a: number, b: number): number {
    return a + b;
  }
};

// ã‚¹ãƒ‘ã‚¤ã‚’ä½œæˆ
const addSpy = vi.spyOn(calculator, 'add');

// ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™
calculator.add(2, 3);

// æ¤œè¨¼
expect(addSpy).toHaveBeenCalledWith(2, 3);
expect(addSpy).toHaveBeenCalledTimes(1);
```

### éƒ¨åˆ†çš„ãªãƒ¢ãƒƒã‚¯
ã‚¯ãƒ©ã‚¹ã‚„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä¸€éƒ¨ã®ãƒ¡ã‚½ãƒƒãƒ‰ã ã‘ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã—ãŸã„å ´åˆã€éƒ¨åˆ†çš„ãªãƒ¢ãƒƒã‚¯ãŒä¾¿åˆ©ã§ã™ã€‚

```ts
class DataService {
  async fetchData(): Promise<any[]> {
    // å®Ÿéš›ã«APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹å‡¦ç†
    return [];
  }

  processData(data: any[]): any[] {
    // ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã™ã‚‹å®Ÿéš›ã®ãƒ­ã‚¸ãƒƒã‚¯
    return data.map(item => ({ ...item, processed: true }));
  }
}

// processDataãƒ¡ã‚½ãƒƒãƒ‰ã¯ãã®ã¾ã¾ã«ã€fetchDataã ã‘ã‚’ãƒ¢ãƒƒã‚¯åŒ–
const service = new DataService();
vi.spyOn(service, 'fetchData').mockResolvedValue([
  { id: 1, name: 'Item 1' },
  { id: 2, name: 'Item 2' }
]);

// fetchDataã¯ãƒ¢ãƒƒã‚¯ã€processDataã¯å®Ÿéš›ã®å®Ÿè£…ãŒä½¿ã‚ã‚Œã‚‹
const result = await service.fetchData().then(data => service.processData(data));

expect(result).toEqual([
  { id: 1, name: 'Item 1', processed: true },
  { id: 2, name: 'Item 2', processed: true }
]);
```

### ãƒ¢ãƒƒã‚¯ã®ãƒªã‚»ãƒƒãƒˆã¨å¾©å…ƒ
ãƒ†ã‚¹ãƒˆé–“ã§ãƒ¢ãƒƒã‚¯ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆã—ãŸã‚Šã€å…ƒã®å®Ÿè£…ã«æˆ»ã—ãŸã‚Šã™ã‚‹æ–¹æ³•ï¼š

```ts
const mockFn = vi.fn();

// ãƒ¢ãƒƒã‚¯ã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆå‘¼ã³å‡ºã—å±¥æ­´ã‚’æ¶ˆå»ï¼‰
mockFn.mockReset();

// ãƒ¢ãƒƒã‚¯ã®å®Ÿè£…ã‚’ã‚¯ãƒªã‚¢ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æœªå®šç¾©ã‚’è¿”ã™å®Ÿè£…ã«æˆ»ã™ï¼‰
mockFn.mockImplementation(() => undefined);

// ã™ã¹ã¦ã®ãƒ¢ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆ
vi.resetAllMocks();

// ã™ã¹ã¦ã®ãƒ¢ãƒƒã‚¯ã‚’å¾©å…ƒï¼ˆãƒ¢ãƒƒã‚¯åŒ–å‰ã®çŠ¶æ…‹ã«æˆ»ã™ï¼‰
vi.restoreAllMocks();
```

## å®Ÿè·µçš„ãªãƒ’ãƒ³ãƒˆ
### 1. é©åˆ‡ãªãƒ¬ãƒ™ãƒ«ã§ãƒ¢ãƒƒã‚¯åŒ–ã™ã‚‹
è¤‡é›‘ãªã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€é©åˆ‡ãªæŠ½è±¡åŒ–ãƒ¬ãƒ™ãƒ«ã§ãƒ¢ãƒƒã‚¯åŒ–ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ä½ãƒ¬ãƒ™ãƒ«ã®å®Ÿè£…è©³ç´°ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã™ã‚‹ã¨ã€å®Ÿè£…ã®å¤‰æ›´ã«å¯¾ã—ã¦ãƒ†ã‚¹ãƒˆãŒè„†ããªã‚Šã¾ã™ã€‚

```ts
// â˜“ æ‚ªã„ä¾‹ï¼šä½ãƒ¬ãƒ™ãƒ«ã®å®Ÿè£…è©³ç´°ã‚’ãƒ¢ãƒƒã‚¯åŒ–
vi.spyOn(dbConnection, '_executeQuery').mockResolvedValue([...]);

// â—¯ è‰¯ã„ä¾‹ï¼šå…¬é–‹APIã‚’ãƒ¢ãƒƒã‚¯åŒ–
vi.spyOn(userRepository, 'findById').mockResolvedValue({...});
```

### 2. ãƒ¢ãƒƒã‚¯ã®éå‰°ä½¿ç”¨ã‚’é¿ã‘ã‚‹
ã™ã¹ã¦ã‚’ãƒ¢ãƒƒã‚¯åŒ–ã™ã‚‹ã¨ã€ãƒ†ã‚¹ãƒˆãŒå®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œã‚’åæ˜ ã—ãªããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚æ™‚ã«ã¯ã€å®Ÿéš›ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

### 3. çµ±åˆãƒ†ã‚¹ãƒˆã¨çµ„ã¿åˆã‚ã›ã‚‹
ãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨ã—ãŸå˜ä½“ãƒ†ã‚¹ãƒˆã¯ã€çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆå®Ÿéš›ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ï¼‰ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šç¢ºå®Ÿãªãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã¨ãªã‚Šã¾ã™ã€‚

### 4. ãƒ¢ãƒƒã‚¯ãƒ•ã‚¡ã‚¯ãƒˆãƒªã‚’æ´»ç”¨ã™ã‚‹
è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆã§åŒã˜ãƒ¢ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€ãƒ¢ãƒƒã‚¯ãƒ•ã‚¡ã‚¯ãƒˆãƒªé–¢æ•°ã‚’ä½œæˆã™ã‚‹ã¨ä¾¿åˆ©ã§ã™ã€‚

```ts
// ãƒ¢ãƒƒã‚¯ãƒ•ã‚¡ã‚¯ãƒˆãƒªé–¢æ•°
function createMockUserRepository() {
  return {
    findById: vi.fn(),
    findAll: vi.fn(),
    save: vi.fn(),
    delete: vi.fn()
  };
}

// ãƒ†ã‚¹ãƒˆã§ä½¿ç”¨
const mockUserRepo = createMockUserRepository();
mockUserRepo.findById.mockResolvedValue({ id: 1, name: 'Test User' });
```

### 5. ãƒ†ã‚¹ãƒˆå¯èƒ½ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
æœ€åˆã‹ã‚‰ãƒ†ã‚¹ãƒˆå¯èƒ½ãªã‚³ãƒ¼ãƒ‰ã‚’è¨­è¨ˆã™ã‚‹ã“ã¨ã§ã€ãƒ¢ãƒƒã‚¯ã®ä½¿ç”¨ãŒç°¡å˜ã«ãªã‚Šã¾ã™ã€‚ä¾å­˜æ€§æ³¨å…¥ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã€é–¢å¿ƒã®åˆ†é›¢ãªã©ã®åŸå‰‡ã‚’é©ç”¨ã—ã¾ã—ã‚‡ã†ã€‚

## ã¾ã¨ã‚
ãƒ¢ãƒƒã‚¯ã¨ã‚¹ã‚¿ãƒ–ã¯ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºã«ãŠã„ã¦å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ãŒã€é©åˆ‡ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚å¤–éƒ¨ä¾å­˜ã‚’éš”é›¢ã—ã€ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œé€Ÿåº¦ã¨ä¿¡é ¼æ€§ã‚’å‘ä¸Šã•ã›ãªãŒã‚‰ã‚‚ã€ãƒ†ã‚¹ãƒˆãŒå®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œã‚’æ­£ç¢ºã«åæ˜ ã™ã‚‹ã‚ˆã†ã«ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚Šã¾ã—ã‚‡ã†ã€‚

æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€[HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ†ã‚¹ãƒˆ](docs/collection-of-TDD-patterns-TypeScript/testing-http-requests.md)æ–¹æ³•ã«ã¤ã„ã¦ã§ã™ã€‚
